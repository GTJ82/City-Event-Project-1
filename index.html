<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="./assets/style.css">
    <script src="http://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="script.js"></script>    
    <script src="https://cdn.aerisapi.com/sdk/js/latest/aerisweather.min.js"></script>
 <link rel="stylesheet" href="https://cdn.aerisapi.com/sdk/js/latest/aerisweather.css">
</head>

<body class="has-navbar-fixed-top">

    <nav class="navbar is is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <div class="titleNav is-fixed-bottom">
                <i class="fas fa-city titleLogo"></i>
                <p class="titleLogo">City Event</p>
            </div>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">
                <ul class="breadcrumb" aria-label="breadcrumbs">
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="far fa-address-card"></i>
                            </span>
                            <span>About Us</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="fas fa-ticket-alt"></i>
                            </span>
                            <span>Get Tickets</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="far fa-compass"></i>
                            </span>
                            <span>Find Location</span>
                        </a>
                    </li>

                </ul>
            </div>
        </div>

    </nav>


    <div class="columns is-mobile marginFix">
        <div class="column is-one-quarter has-background-grey is-mobile">
            <div class="field is-grouped is-centered">
                <p class="control is-expanded">
                    <input id="search-bar" class="input" type="text" placeholder="Find a repository">
                </p>
                <p class="control">
                    <a id="search-btn" class="button is-success">
                        Search
                    </a>
                </p>
            </div>
            <br>
            <div class="control is-success">
                <div class="select">
                    <select>
                        <option value="sports">Sports</option>
                        <option value="concerts">Concerts</option>
                        <option value="festivals">Festivals</option>
                    </select>
                </div>
            </div>

        </div>
        <div class="column has-background-grey-lighter noPadding">


            <div class="column right is-mobile">
                <figure class="image">
                    <img src="https://wallpaperstream.com/wallpapers/full/new-york-city/New-York-City-Background.jpg">

                    <section class="section">
                        <div class="container">
                            <h1 id="city-name" class="title"></h1>
                            <div id="obs"><strong></strong></div>
                        </div>
                    </section>


                    <div class="box-card level-item">
                        <article class="media">
                            <div class="media-content">
                                <div id="event-div" class="content">
                                    <h1>Upcoming Events in the Area</h1>
                                </div>
                            </div>
                        </article>
                    </div>


                </figure>
            </div>

        </div>
    </div>
    </section>

    <footer>
        <div class="footer">
            <div class="footerList">
                <ul>
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="fab fa-twitter-square"></i>
                            </span>
                            <span>Twitter</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="fab fa-facebook-square"></i>
                            </span>
                            <span>Facebook</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <span class="icon is-small">
                                <i class="fab fa-instagram"></i>
                            </span>
                            <span>Instagram</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </div>
  

  </footer>
  
  <script>
        $(document).ready(function(){
            var eventDiv = $("#event-div");
            eventDiv.empty();
            
            $('#search-btn').click(function(){

                var city = $('#search-bar').val();
                $('#search-bar').empty();
                $('#city-name').empty();
                $('#obs').empty();
                $("#city-name").append(city).val();

                const aeris = new AerisWeather('HEfYwdO02yETMJe9NBZ3T', 'FMCogyv4t0bjMRYDn5pqOeFIorgecFqvxGcl3SP0');


                aeris.api().endpoint('observations').place(city).get().then((result) => {
                const data = result.data.ob;
                document.getElementById('obs').innerHTML = `The current weather is ${data.weatherPrimary.toLowerCase()} and ${data.tempF} degrees.`;
                });

            $.ajax({
                url: "https://api.predicthq.com/v1/places?&q=" + $('#search-bar').val() ,
                method: "GET",
                headers: {
                    "Authorization": "Bearer ZCp-pKAM3FPo7RGmIGKTvj82xVv9zGkfJ2drwwU6"
                }
            }).then(function (response) {
                    $("#city-name").append(city).val();
                    eventDiv.empty();
                    console.log(response);
                    var cityID = response.results[0].id;
                    var city = $('#search-bar').val();
                    $.ajax({
                        url: "https://api.predicthq.com/v1/events?place.scope=" + cityID + "&category=" + $('select').val(),
                        method: "GET",
                        headers: {
                            "Authorization": "Bearer ZCp-pKAM3FPo7RGmIGKTvj82xVv9zGkfJ2drwwU6"
                        }
                    }).then(function (response) {
                        function createCard(){
                            if (title){
                                eventDiv.append("<h4>" + title + "</h4>");
                            }
                            if (time){
                                eventDiv.append("<p>"+ time + "</p>");
                            }
                            if(description){
                            eventDiv.append("<p>"+ description + "</p>");
                            }
                            if(venue){
                                eventDiv.append("<p>"+ venue + "</p>");
                            }
                            else if(!venue){
                                eventDiv.append("<p>no venue listed</p>");
                            }    
                            $(".content").prepend(eventDiv);
                            

                        }

                        console.log(response);
                        var searchResults = response.results;

                        for(var i = 0; i < searchResults.length; i ++){
                            var eventDiv = $("#event-div");
                            var newResult = searchResults[i];
                            var title = newResult.title; 
                            var time = newResult.start;
                            var description = newResult.description;
                            var venue = "";
                            if (newResult.entities[0]){
                                venue =  newResult.entities[0].name;
                            }
                            createCard();
                        }


                        
                    });
                }); 
                //     var accessKey = "HEfYwdO02yETMJe9NBZ3T&";
                //     var clientSecret = "FMCogyv4t0bjMRYDn5pqOeFIorgecFqvxGcl3SP0";
                //     var city = $('#search-bar').val();
                    
                //  $.ajax ({

                //     URL: "http://api.aerisapi.com/places/observations/" + city + "client_id=" + accessKey + "client_secret=" + clientSecret ,
                //     method: "GET",

                //  }).then(function(response){
                //     console.log(response);
                //  });   
            }); 
        }); 
        </script>
  

</body>


</html>
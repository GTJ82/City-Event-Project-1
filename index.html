<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>City Event</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="./assets/style.css">
    <script src="http://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="script.js"></script>    
    <script src="https://cdn.aerisapi.com/sdk/js/latest/aerisweather.min.js"></script>
 <link rel="stylesheet" href="https://cdn.aerisapi.com/sdk/js/latest/aerisweather.css">
</head>

<body class="has-navbar-fixed-top">

    <nav class="navbar is is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <div class="titleNav is-fixed-bottom">
                <img id="cityEventLogo" src="./assets/Images/CityEventLogo.png" alt="">
            </div>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">
                <ul class="breadcrumb" aria-label="breadcrumbs">

                    <li>
                        <a href="https://www.stubhub.com/">
                            <span class="icon is-small">
                                <i class="fas fa-ticket-alt"></i>
                            </span>
                            <span class="textLink">Get Tickets</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.google.com/maps">
                            <span class="icon is-small">
                                <i class="far fa-compass"></i>
                            </span>
                            <span class="textLink">Find Location</span>
                        </a>
                    </li>

                </ul>
            </div>
        </div>

    </nav>


    <div class="columns is-mobile marginFix site-content">
        <div class="column is-one-quarter is-mobile">
            <div class="field is-grouped is-centered">
                <p class="control is-expanded">
                    <input id="search-bar" class="input" type="text" placeholder="Find a repository">
                </p>
                <p class="control">
                    <a id="search-btn" class="button is-success">
                        Search
                    </a>
                </p>
            </div>
            <br>
            <div class="control is-success search-button">
                <div class="select">
                    <select>
                        <option value="sports">Sports</option>
                        <option value="concerts">Concerts</option>
                        <option value="festivals">Festivals</option>
                    </select>
                </div>
            </div>

        </div>


        <div class="column right is-mobile background-image">
            <section class="section">
                <div class="container">
                    <h1 id="city-name" class="title"></h1>
                    <span id="obs"><strong></strong></span>
                    
                </div>


                <div  class="card">
                    <div id="event-div" class="card-content">
                        <div class="media">
                            <div class="media-left">
                                <figure class="image is-48x48">
                                    <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                                </figure>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>


    </div>
    </section>

    <footer>
        <div class="footer">
            <div class="inner-footer">
                <div id="aboutUs" class="footer-items">
                    <h1>About Us</h1>
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eum obcaecati assumenda ratione quidem
                        quis debitis itaque facilis doloremque.
                        Ipsam, nam? Sed incidunt, ea commodi nemo id praesentium sunt maiores quod.
                    </p>
                </div>
                <div id="socialMedia" class="footer-items">
                    <h2>Social Media</h2>
                    <div class="border"></div>
                    <ul>
                        <li>
                            <a href="https://twitter.com/CityEvent3">
                                <span class="icon is-small">
                                    <i class="fab fa-twitter-square"></i>
                                </span>
                                <span class="textLink">Twitter</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/">
                                <span class="icon is-small">
                                    <i class="fab fa-facebook-square"></i>
                                </span>
                                <span class="textLink">Facebook</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/cityevent2019/">
                                <span class="icon is-small">
                                    <i class="fab fa-instagram"></i>
                                </span>
                                <span class="textLink">Instagram</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div id="letsConnect" class="footer-items">
                    <h2>Let's Connect</h2>
                    <div class="border"></div>
                    <ul>
                        <li><i class="fas fa-map-pin"></i> 320 E 9th St. Charlotte, NC 28202</li>
                        <li><i class="fas fa-phone"></i> 704-555-5555</li>
                        <li><i class="fas fa-envelope-open-text"></i> cityevent2019@gmail.com</li>
                    </ul>

                </div>
            </div>
            <div class="footer-bottom">
                Copyright &copy; City Event 2019, All rights reserved.
            </div>
        </div>

    </div>
  

  </footer>
  
  <script>
        $(document).ready(function(){
            var eventDiv = $("#event-div");
            eventDiv.empty();
            
            $('#search-btn').click(function(){

                var city = $('#search-bar').val();
                $('#search-bar').empty();
                $('#city-name').empty();
                $('#obs').empty();
                $("#city-name").append(city).val();

                const aeris = new AerisWeather('HEfYwdO02yETMJe9NBZ3T', 'FMCogyv4t0bjMRYDn5pqOeFIorgecFqvxGcl3SP0');


                aeris.api().endpoint('observations').place(city).get().then((result) => {
                const data = result.data.ob;
                document.getElementById('obs').innerHTML = `The current weather is ${data.weatherPrimary.toLowerCase()} and ${data.tempF} degrees.`;
                });

            $.ajax({
                url: "https://api.predicthq.com/v1/places?&q=" + $('#search-bar').val() ,
                method: "GET",
                headers: {
                    "Authorization": "Bearer ZCp-pKAM3FPo7RGmIGKTvj82xVv9zGkfJ2drwwU6"
                }
            }).then(function (response) {
                    $("#city-name").append(city).val();
                    eventDiv.empty();
                    console.log(response);
                    var cityID = response.results[0].id;
                    var city = $('#search-bar').val();
                    $.ajax({
                        url: "https://api.predicthq.com/v1/events?place.scope=" + cityID + "&category=" + $('select').val(),
                        method: "GET",
                        headers: {
                            "Authorization": "Bearer ZCp-pKAM3FPo7RGmIGKTvj82xVv9zGkfJ2drwwU6"
                        }
                    }).then(function (response) {
                        function createCard(){
                            if (title){
                                eventDiv.append("<h3><strong>" + title + "</strong></h3>");
                            }
                            if (time){
                                eventDiv.append("<span>"+ time + "</span>");
                            }
                            if(description){
                            eventDiv.append("<p>"+ description + "</p>");
                            }
                            if(venue){
                                eventDiv.append("<p>"+ venue + "</p>");
                            }
                            else if(!venue){
                                eventDiv.append("<p>no venue listed</p>");
                            }    
                            $(".content").prepend(eventDiv);
                            

                        }

                        console.log(response);
                        var searchResults = response.results;

                        for(var i = 0; i < searchResults.length; i ++){
                            var eventDiv = $("#event-div");
                            var newResult = searchResults[i];
                            var title = newResult.title; 
                            var time = newResult.start;
                            var description = newResult.description;
                            var venue = "";
                            if (newResult.entities[0]){
                                venue =  newResult.entities[0].name;
                            }
                            createCard();
                        }
                    });
                }); 
            }); 
        }); 
        </script>
  


</body>


</html>